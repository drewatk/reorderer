$(document).ready(function(){function t(){$.ajax({url:"https://api.spotify.com/v1/me",headers:{Authorization:"Bearer "+k},success:function(t){r=t.id,f.innerHTML=m(t),$("#loggedout").hide(),$("#loggedin").show()}}),o()}function e(){$("#loggedout").show(),$("#loggedin").hide(),$("#login-button").on("click",i)}function o(){$.ajax({url:"https://api.spotify.com/v1/me/playlists",headers:{Authorization:"Bearer "+k},success:function(t){console.log(t),$("#playlists").html(y(t)),$(".playlist-link").on("click",function(){n($(this).data("playlistHref"))}),$("#playlists").show(),$("#tracks").hide()}})}function n(t){$.ajax({url:t,headers:{Authorization:"Bearer "+k},success:function(t){console.log(t),$("#tracks").html(g(t));var e,n;$("#sortable").sortable({update:function(o,i){n=i.item.index(),a(t.tracks.href,e,n)},start:function(t,o){e=o.item.index()}}),$("#tracks-back").on("click",function(){o()}),$("#playlists").hide(),$("#tracks").show()}})}function a(t,e,o){$.ajax({url:t,method:"PUT",data:JSON.stringify({range_start:e,insert_before:o}),contentType:"application/json",headers:{Authorization:"Bearer "+k},success:function(t){console.log(t)}})}function i(){console.log("Requesting Authorization...");var t=l(16);localStorage.setItem(c,t);var e="https://accounts.spotify.com/authorize";e+="?response_type=token",e+="&client_id="+encodeURIComponent(d),e+="&scope="+encodeURIComponent(u),e+="&redirect_uri="+encodeURIComponent(p),e+="&state="+encodeURIComponent(t),window.location=e}function l(t){for(var e="",o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=0;t>n;n++)e+=o.charAt(Math.floor(Math.random()*o.length));return e}function s(){for(var t,e={},o=/([^&;=]+)=?([^&;]*)/g,n=window.location.hash.substring(1);t=o.exec(n);)e[t[1]]=decodeURIComponent(t[2]);return e}var r,c="spotify_auth_state",u="playlist-modify-public playlist-modify-private playlist-read-private playlist-read-collaborative",d="945d641a6b2e4d0eb717daa495f4e188",p="http://www.drewatkinson.me/reorderify/",h=document.getElementById("user-profile-template").innerHTML,m=Handlebars.compile(h),f=document.getElementById("user-profile"),g=Handlebars.compile($("#tracks-template").html()),y=Handlebars.compile($("#playlists-template").html()),b=s(),k=b.access_token,v=b.state,w=localStorage.getItem(c);!k||null!=v&&v===w?(localStorage.removeItem(c),k?t():e()):window.location="/"});
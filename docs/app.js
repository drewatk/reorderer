$(document).ready(function(){function e(){$.ajax({url:"https://api.spotify.com/v1/me",headers:{Authorization:"Bearer "+w},success:function(e){s=e.id,m.innerHTML=f(e),$("#loggedout").hide(),$("#loggedin").show()}}),o()}function t(){$("#loggedout").show(),$("#loggedin").hide(),$("#login-button").on("click",i)}function o(){$.ajax({url:"https://api.spotify.com/v1/me/playlists",headers:{Authorization:"Bearer "+w},success:function(e){console.log(e),Handlebars.registerHelper("each_owned",function(e,t){result="";for(var o=0;o<e.length;o++)e[o].owner.id===s&&(result+=t.fn(e[o]));return result}),$("#playlists").html(y(e)),$(".playlist-link").on("click",function(){n($(this).data("playlistHref"))}),$("#playlists").show(),$("#tracks").hide()}})}function n(e){$.ajax({url:e,headers:{Authorization:"Bearer "+w},success:function(e){console.log(e),$("#tracks").html(g(e));var t,n;$("#sortable").sortable({update:function(o,i){n=i.item.index(),a(e.tracks.href,t,n)},start:function(e,o){t=o.item.index()}}),$("#tracks-back").on("click",function(){o()}),$("#playlists").hide(),$("#tracks").show()}})}function a(e,t,o){$.ajax({url:e,method:"PUT",data:JSON.stringify({range_start:t,insert_before:o}),contentType:"application/json",headers:{Authorization:"Bearer "+w},success:function(e){console.log(e)}})}function i(){console.log("Requesting Authorization...");var e=r(16);localStorage.setItem(c,e);var t="https://accounts.spotify.com/authorize";t+="?response_type=token",t+="&client_id="+encodeURIComponent(d),t+="&scope="+encodeURIComponent(u),t+="&redirect_uri="+encodeURIComponent(p),t+="&state="+encodeURIComponent(e),window.location=t}function r(e){for(var t="",o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=0;e>n;n++)t+=o.charAt(Math.floor(Math.random()*o.length));return t}function l(){for(var e,t={},o=/([^&;=]+)=?([^&;]*)/g,n=window.location.hash.substring(1);e=o.exec(n);)t[e[1]]=decodeURIComponent(e[2]);return t}var s,c="spotify_auth_state",u="playlist-modify-public playlist-modify-private playlist-read-private playlist-read-collaborative",d="945d641a6b2e4d0eb717daa495f4e188",p=window.location.href,h=document.getElementById("user-profile-template").innerHTML,f=Handlebars.compile(h),m=document.getElementById("user-profile"),g=Handlebars.compile($("#tracks-template").html()),y=Handlebars.compile($("#playlists-template").html()),b=l(),w=b.access_token,k=b.state,v=localStorage.getItem(c);!w||null!==k&&k===v?(localStorage.removeItem(c),w?e():t()):window.location="/"});